{"ast":null,"code":"import { Server } from 'socket.io';\nimport { db } from '../../utils/firebase';\nimport { collection } from '../../utils/variables';\n\nconst ioHandler = (req, res) => {\n  if (!res.socket.server.io) {\n    console.log('*First use, starting socket.io');\n    const io = new Server(res.socket.server);\n    io.on('connection', socket => {\n      socket.on('message', data => {\n        const {\n          id,\n          time\n        } = data;\n\n        async function update() {\n          await db.doc(`${collection}/${id}`).update({\n            time: time\n          });\n        }\n\n        update();\n      });\n      socket.on('disconnect', () => console.log('desconectado'));\n    });\n    res.socket.server.io = io;\n  } else {\n    console.log('socket.io already running');\n  }\n\n  res.end();\n};\n\nexport const config = {\n  api: {\n    bodyParser: false\n  }\n};\nexport default ioHandler;","map":null,"metadata":{},"sourceType":"module"}